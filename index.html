<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Lab ‚Äì Route matching</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script>
  <h3>Laboratorium: 2</h3>
/* ======================================================
   üîë TUTAJ WKLEJ SW√ìJ GOOGLE MAPS API KEY
   ====================================================== */
const API_KEY = "AIzaSyCDoDGbQRTKYV1T1isARxO1e5UyLZqMJrM";

/* ======================================================
   ROUTES API ‚Äì pobieranie trasy (zakrƒôt po zakrƒôcie)
   ====================================================== */
async function getRoute(origin, destination) {
  const response = await fetch(
    "https://routes.googleapis.com/directions/v2:computeRoutes",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-Goog-Api-Key": API_KEY,
        "X-Goog-FieldMask": "routes.polyline.encodedPolyline"
      },
      body: JSON.stringify({
        origin: { location: { latLng: origin } },
        destination: { location: { latLng: destination } },
        travelMode: "DRIVE"
      })
    }
  );

  const data = await response.json();
  return data.routes[0].polyline.encodedPolyline;
}

/* ======================================================
   Google polyline ‚Üí lista punkt√≥w
   ====================================================== */
function decodePolyline(encoded) {
  return google.maps.geometry.encoding.decodePath(encoded);
}

/* ======================================================
   INIT MAP
   ====================================================== */
async function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 52.105, lng: 19.955 },
    zoom: 14
  });

  /* üöó Kierowca: Poczta Polska ‚Üí Baumit */
  const driverEncoded = await getRoute(
    { lat: 52.1054, lng: 19.9522 }, // Poczta Polska
    { lat: 52.1016, lng: 19.9604 }  // Baumit
  );

  /* üßç Pasa≈ºer: Media Expert ‚Üí Szpital */
  const passengerEncoded = await getRoute(
    { lat: 52.1076, lng: 19.9466 }, // Media Expert
    { lat: 52.1039, lng: 19.9586 }  // Szpital
  );

  const driverPath = decodePolyline(driverEncoded);
  const passengerPath = decodePolyline(passengerEncoded);

  /* üîµ Trasa kierowcy */
  new google.maps.Polyline({
    path: driverPath,
    map,
    strokeColor: "blue",
    strokeWeight: 4
  });

  /* üî¥ Trasa pasa≈ºera */
  new google.maps.Polyline({
    path: passengerPath,
    map,
    strokeColor: "red",
    strokeWeight: 4
  });
}
</script>

<!-- ======================================================
     Google Maps JS API
     ‚ö†Ô∏è geometry jest WYMAGANE
     ====================================================== -->
<script
  async
  defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDoDGbQRTKYV1T1isARxO1e5UyLZqMJrM&callback=initMap&libraries=geometry">
</script>

</body>
</html>
